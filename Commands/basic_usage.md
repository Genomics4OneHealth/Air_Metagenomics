# Detailed Commands for Air Monitoring Nanopore Sequencing Pipeline

This document provides a comprehensive list of commands for each tool used in the Air Monitoring by Nanopore Sequencing pipeline, with detailed explanations of the flags and options used.

## Table of Contents
1. [Guppy Basecaller](#1-guppy-basecaller)
2. [Porechop](#2-porechop)
3. [NanoFilt](#3-nanofilt)
4. [Flye](#4-flye)
5. [Minimap2](#5-minimap2)
6. [Racon](#6-racon)
7. [MetaWRAP](#7-metawrap)
8. [Prodigal](#8-prodigal)
9. [EggNOG-mapper](#9-eggnog-mapper)
10. [CheckM](#10-checkm)
11. [Kraken2](#11-kraken2)
12. [DIAMOND](#12-diamond)

## 1. Guppy Basecaller
Converts raw electrical signal data from nanopore sequencing into DNA sequences.

```bash
guppy_basecaller -i /input/directory -s /output/directory --config configuration.cfg
```

- `-i /input/directory`: Specifies the input directory containing raw signal data (.fast5 files)
- `-s /output/directory`: Specifies the output directory for basecalled sequences
- `--config configuration.cfg`: Specifies the configuration file containing model and other settings

## 2. Porechop
Finds and removes adapters from Oxford Nanopore reads.

```bash
porechop -i input.fastq -o output.fastq
```

- `-i input.fastq`: Specifies the input FASTQ file containing raw reads
- `-o output.fastq`: Specifies the output FASTQ file for adapter-trimmed reads

## 3. NanoFilt
Filters Oxford Nanopore sequencing data based on quality and length.

```bash
gunzip -c input.fastq.gz | NanoFilt -q 9 -l 100 | gzip > output.fastq.gz
```

- `gunzip -c input.fastq.gz`: Decompresses the input file and writes to standard output
- `NanoFilt -q 9 -l 100`: Filters reads, keeping those with quality ≥ 9 and length ≥ 100 bases
- `gzip > output.fastq.gz`: Compresses the filtered output and saves it

## 4. Flye
De novo assembler for single-molecule sequencing reads, run in 'meta' mode for metagenomic data.

```bash
flye --meta --nano-raw input.fastq --out-dir output_directory 
```

- `--meta`: Enables metagenomic mode for assembling mixed samples
- `--nano-raw input.fastq`: Specifies input file of raw Nanopore reads
- `--out-dir output_directory`: Specifies the output directory for assembly results

## 5. Minimap2
Aligns DNA sequences against a large reference database.

```bash
minimap2 -ax map-ont /path/to/flye/output/assembly.fasta /path/to/nanofilt/output/reads.fastq | samtools sort -o /path/to/minimap2/output/reads.sorted.bam
```

- `-ax map-ont`: Sets the alignment mode for Oxford Nanopore reads
- `/path/to/flye/output/assembly.fasta`: Specifies the reference assembly
- `/path/to/nanofilt/output/reads.fastq`: Specifies the input reads to align
- `samtools sort -o /path/to/minimap2/output/reads.sorted.bam`: Sorts the alignment and outputs as a BAM file

## 6. Racon
Consensus module to correct raw contigs generated by rapid assembly methods.

```bash
racon /path/to/nanofilt/output/reads.fastq /path/to/minimap2/output/reads.sam /path/to/flye/output/assembly.fasta > /path/to/racon/output/assembly.polished.fasta
```

- First argument: Path to the filtered reads
- Second argument: Path to the alignment file (SAM format)
- Third argument: Path to the initial assembly
- `> /path/to/racon/output/assembly.polished.fasta`: Redirects the polished assembly to an output file

## 7. MetaWRAP
Modular pipeline for metagenomic analysis, including binning and bin refinement.

### Binning:
```bash
metawrap binning -o /output/directory -t 16 -a /input/assembly.fasta --metabat2 --maxbin2 --concoct /input/read_1.fastq /input/read_2.fastq
```

- `-o /output/directory`: Specifies the output directory
- `-t 16`: Sets the number of threads to use
- `-a /input/assembly.fasta`: Specifies the input assembly file
- `--metabat2 --maxbin2 --concoct`: Enables these three binning algorithms
- `/input/read_1.fastq /input/read_2.fastq`: Specifies the input read files

### Bin Refinement:
```bash
metawrap bin_refinement -o /output/directory -t 16 -A /input/bin_set1 -B /input/bin_set2 -C /input/bin_set3 -c 70 -x 10
```

- `-o /output/directory`: Specifies the output directory
- `-t 16`: Sets the number of threads to use
- `-A /input/bin_set1 -B /input/bin_set2 -C /input/bin_set3`: Specifies input bin sets from different binning algorithms
- `-c 70`: Sets the minimum completion threshold to 70%
- `-x 10`: Sets the maximum contamination threshold to 10%

## 8. Prodigal
Microbial gene finding program.

```bash
prodigal -i /path/to/assembly.fasta -a /path/to/proteins.faa -o /path/to/prodigal_output.gbk -p meta
```

- `-i /path/to/assembly.fasta`: Specifies the input FASTA file
- `-a /path/to/proteins.faa`: Specifies the output file for protein sequences
- `-o /path/to/prodigal_output.gbk`: Specifies the output file in Genbank format
- `-p meta`: Sets the procedure to metagenomic mode

## 9. EggNOG-mapper
Tool for fast functional annotation of novel sequences.

```bash
emapper.py -i /path/to/proteins.faa -o /path/to/eggnog_output -m diamond --cpu 8 --data_dir /path/to/eggnog_data/
```

- `-i /path/to/proteins.faa`: Specifies the input protein FASTA file
- `-o /path/to/eggnog_output`: Specifies the output file prefix
- `-m diamond`: Sets the search method to DIAMOND
- `--cpu 8`: Sets the number of CPU cores to use
- `--data_dir /path/to/eggnog_data/`: Specifies the directory containing eggNOG data files

## 10. CheckM
Assesses the quality of genomes recovered from metagenomes.

```bash
checkm lineage_wf /path/to/bins/ /path/to/checkm_output/
```

- `lineage_wf`: Specifies the lineage-specific workflow
- `/path/to/bins/`: Specifies the directory containing genome bins
- `/path/to/checkm_output/`: Specifies the output directory for CheckM results

## 11. Kraken2
Assigns taxonomic labels to short DNA sequences.

```bash
kraken2 --db kraken_db_finalized --use-names --report report_samplename.txt --output output_samplename.txt sample.fastq --memory-mapping --threads 24
```

- `--db kraken_db_finalized`: Specifies the path to the Kraken2 database
- `--use-names`: Adds taxa names to the output
- `--report report_samplename.txt`: Specifies the file for the kraken report
- `--output output_samplename.txt`: Specifies the file for kraken output
- `sample.fastq`: Specifies the input FASTQ file
- `--memory-mapping`: Uses memory mapping to load the database, reducing memory usage
- `--threads 24`: Sets the number of threads to use

## 12. DIAMOND
Performs fast protein alignments.

```bash
diamond blastx -d diamond_db -q sample.fastq -o sample_name_blastx.dmnd_out -f 6 qseqid sseqid pident length mismatch gapopen qstart qend sstart send evalue bitscore staxids salltitles sscinames
```

- `blastx`: Specifies the BLASTX-like translated search
- `-d diamond_db`: Specifies the DIAMOND formatted database file
- `-q sample.fastq`: Specifies the input query file in FASTQ format
- `-o sample_name_blastx.dmnd_out`: Specifies the output file
- `-f 6`: Sets the output format to tabular
- The remaining parameters specify the fields to include in the output (e.g., query sequence id, subject sequence id, percentage of identical matches, etc.)

Note: Replace file paths and parameter values as needed for your specific setup and data. Consult each tool's documentation for detailed information on available options and best practices.
